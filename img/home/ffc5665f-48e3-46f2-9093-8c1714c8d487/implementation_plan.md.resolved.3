# 實作計畫：儲值訂單管理 (OPE-601)

本計畫旨在建立一個多維度的儲值訂單監控與管理介面，包含即時數據分析、趨勢圖表及詳細的操作紀錄。

## 使用者審閱確認

> [!IMPORTANT]
> **圖表程式庫選擇**：由於專案目前未安裝圖表庫，我將在 `DepositOrders.vue` 中動態載入 `echarts`  CDN 或建議安裝 `echarts` 依賴。為確保穩定性，本計畫優先採用 Naive UI 配合自定義畫布或現有圖表元件。

## 擬議變更

### 1. 資料模型與 API

#### [NEW] [depositOrder.ts](file:///c:/Users/Administrator/Desktop/營運後台/src/types/depositOrder.ts)
- 定義 `DepositOrder` 介面。
- 定義 `DepositStats` (看板數據) 與 `TrendData` (趨勢圖) 類型。

#### [NEW] [depositOrder.ts](file:///c:/Users/Administrator/Desktop/營運後台/src/mocks/depositOrder.ts)
- 生成模擬訂單數據，包含各個狀態、渠道、金額及手續費。
- 提供符合 OPE-601 邏輯的統計聚合方法。

#### [NEW] [depositOrder.ts](file:///c:/Users/Administrator/Desktop/營運後台/src/api/depositOrder.ts)
- [list](file:///c:/Users/Administrator/Desktop/%E7%87%9F%E9%81%8B%E5%BE%8C%E5%8F%B0/src/api/whitelist.ts#30-34): 取得訂單列表。
- `stats`: 取得頂部看板數據。
- `trend`: 取得趨勢分析數據。
- `sync`: 查單功能。
- `manualComplete`: 人工補單。
- `logs`: 取得訂單生命週期日誌。

### 2. 前端介面實作

#### [NEW] [DepositOrders.vue](file:///c:/Users/Administrator/Desktop/營運後台/src/views/Master/DepositOrders.vue)
- **頂部數據看板**：使用 `NGrid` 與 `NCard` 顯示統計指標（總額、手續費、訂單數），並內嵌圓餅圖。
- **中間趨勢圖**：使用 ECharts 展示成功金額曲線與訂單數長條圖，並標註紅線預警。
- **查詢條件**：日期範圍、玩家 ID、狀態、渠道、單號過濾。
- **數據列表**：展示詳細訂單欄位，支援跳轉、查單、補單與日誌詳情。

### 3. 配置與路由

#### [MODIFY] [index.ts](file:///c:/Users/Administrator/Desktop/營運後台/src/router/index.ts)
- 新增 `/admin/deposit-orders` 路由。

#### [MODIFY] [Layout.vue](file:///c:/Users/Administrator/Desktop/營運後台/src/views/Master/Layout.vue)
- 在側邊欄「金流管理」或「營運資料」分類下新增「儲值訂單管理」入口。

---

## 驗證計畫

### 自動化/手動測試
1. **數據一致性**：點擊過濾後，看板、圖表與列表數據必須同步更新。
2. **手續費試算**：驗證 iOS 訂單（30% 手續費）在列表中的顯示是否正確。
3. **查單/補單流**：模擬查單成功後狀態變更為「成功」；驗證補單時憑證上傳與必填項檢查。
4. **日誌完整性**：確認日誌彈窗包含狀態變遷與原始 JSON 數據。
