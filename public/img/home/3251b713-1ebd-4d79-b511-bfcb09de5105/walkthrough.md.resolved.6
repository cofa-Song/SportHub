# OPE-201 玩家管理模組 - 驗證指南

本指南旨在協助驗證 OPE-201 玩家管理列表與詳情功能的正確性。

## 1. 驗證環境
- 啟動開發伺服器: `npm run dev` in `營運後台` folder.
- 登入帳號: `dev_admin` / `dev123456`
- 進入路由: `/admin/players` (或點擊側邊欄「玩家管理」)

## 2. 驗收標準 (Acceptance Criteria) 覆蓋

### [x] AC 1：註冊來源追蹤驗證
- **測試步驟**: 查看玩家列表或詳情頁中的「註冊來源」。
- **預期結果**: 應顯示 `Admin_Manual` (後台新增) 或 `SEO_Google` (Mock 數據)。

### [x] AC 2：測試帳號數據隔離
- **測試步驟**: 在列表頁使用「新增玩家」，標籤預設鎖定為 `TEST`。
- **預期結果**: 新增成功後，該帳號帶有黃色 `TEST` 標籤。

### [x] AC 3：流水轉化準確性 (模擬)
- **測試步驟**: 在詳情頁「錢包監控」查看「流水活動錢包」餘額。
- **預期結果**: 點擊「放棄當前獎勵」後，該餘額應歸零，且觸發異動紀錄。

### [x] AC 4：編輯紀錄完整性
- **測試步驟**: 修改玩家資料或帳戶狀態 (如: 正常 -> 鎖定)。
- **預期結果**: 
    1. 系統彈出強制填寫原因視窗。
    2. 操作後，在「異動紀錄」Tab 中可見最新的一筆操作紀錄，包含操作人、原因與變更值。

### [x] AC 5：錢包數據顯示
- **測試步驟**: 查看詳情頁的「錢包監控」Tab。
- **預期結果**: 應正確區分四種錢包 (儲值金幣、保險箱、通用銀幣、活動銀幣) 的餘額。

## 3. 功能展示

### 玩家列表 (Player List)
- 支援 ID/帳號搜尋
- 狀態/標籤篩選
- 分頁功能

### 玩家詳情 (Player Detail)
- **基本資料**: 顯示註冊資訊與 VIP 等級。
- **狀態管理**: 支援一鍵鎖定/凍結，並可勾選「強制踢線」。
- **錢包監控**: 視覺化展示各錢包餘額。
- **異動日誌**: 完整留痕所有敏感操作。

## OPE-202 核心帳務引擎 - 驗證指南

本模組透過「模擬引擎」與「開發者工具」來驗證複雜的流水邏輯。

### [ ] AC 1：流水累計驗證
- **前置**: 找一位有「流水活動錢包」且狀態為 ACTIVE 的玩家 (Mock 資料中每 5 位玩家有一位，如 `P10000`, `P10005`)。
- **測試步驟**:
    1. 在詳情頁「流水活動錢包」區塊，點擊「模擬投注 (10)」。
    2. 觀察「流水監控」進度條是否增加 10。
    3. 觀察「當前餘額」是否減少 10。
- **預期結果**: 進度與餘額同步變更。

### [ ] AC 2：達標轉換驗證
- **前置**: 挑選一個剩餘流水較低的玩家，或多次點擊「模擬投注」直到 `Current >= Target`。
- **測試步驟**:
    1. 繼續投注直到達標。
    2. 觀察介面變化。
- **預期結果**:
    1. 活動錢包歸零。
    2. 儲值錢包 (Cash) 餘額增加 (增加金額為 [min(活動餘額, Cap)](file:///c:/Users/Administrator/Desktop/%E7%87%9F%E9%81%8B%E5%BE%8C%E5%8F%B0/src/types/index.ts#47-63))。
    3. 容器狀態重置，若 Queue 中有卡片，會自動載入下一張。

### [ ] AC 3：放棄獎勵驗證
- **測試步驟**: 點擊「放棄獎勵」按鈕並確認。
- **預期結果**: 活動錢包歸零，容器重置。

### [ ] AC 4：破產機制驗證
- **測試步驟**: 持續投注直到銀幣餘額 < 1。
- **預期結果**: 觸發破產保護，容器自動重置。

## OPE-203 資產與流水變動日誌 - 驗證指南

本模組提供完整的資金異動審計。請至 `/admin/asset-logs` 查看日誌。

### [ ] AC 1：幣別隔離流水驗證
- **測試步驟**:
    1. 在玩家詳情頁，先點擊「模擬投注 (10)」。(這是銀幣，有效流水應為 10)
    2. 到「資金日誌」頁面查詢該玩家。
    3. 確認有一筆 `BET` 紀錄，幣別 `SILVER`，有效流水 `10`。
    4. 回到詳情頁，假設我們有金幣投注功能(或透過 P2P 消耗金幣)，此處以「金幣兌換」模擬金幣消耗。
    5. 執行金幣相關操作 (如 P2P 轉出)。
    6. 確認日誌中金幣操作的 `Valid Turnover` 為 `0` 或 `-`。

### [ ] AC 2：金銀互換軌跡驗證
- **測試步驟**:
    1. 在詳情頁點擊「金轉銀 (1)」。
    2. 查看日誌，應出現兩筆 `EXCHANGE` 紀錄：
        *   `CASH` (Gold): Amount `-1`
        *   `BONUS` (Silver): Amount `+100`

### [ ] AC 3：活動解鎖清零驗證
- **測試步驟**:
    1. 完成活動解鎖 (參考 OPE-202 AC2)。
    2. 查看日誌，應依序出現：
        *   `UNLOCK` (Bonus): 扣除餘額
        *   `UNLOCK` (Cash): 增加餘額
        *   `WIPE` (Bonus): 若有溢出，紀錄清零

### [ ] AC 4：P2P 轉帳紀錄驗證
- **測試步驟**:
    1. 在詳情頁點擊「P2P 轉出 (100)」。
    2. 查看日誌，應出現：
        *   `P2P_OUT`: Amount `-108` (含手續費)，關聯單號為接收者 ID。
    3. 搜尋接收者 ID (模擬器會提示轉給誰，如 `P100xx`)。
    4. 查看接收者日誌，應出現：
        *   `P2P_IN`: Amount `+100`，關聯單號為發送者 ID。

## OPE-204 遊戲對局紀錄 - 驗證指南

本模組為第三方遊戲對接的核心稽核介面。請至「玩家管理 > 遊戲對局紀錄」或 `/admin/game-logs` 查看。

### [ ] AC 1：數據一致性驗證 (Mock)
- **測試步驟**:
    1. 觀察列表中的「中獎金額」與「投注金額」。
    2. 確認「輸贏結果」= 中獎 - 投注 (顏色：綠贏紅輸)。
    3. 隨機挑選 3-5 筆資料，驗證算數正確性。

### [ ] AC 2：有效流水判定驗證
- **測試步驟**:
    1. 在篩選欄「局號」輸入 `void` 或尋找狀態為 `VOID` 的註銷單 (Mock 數據中約 5% 機率)。
    2. 確認該筆資料的「有效流水」顯示為 `0` (且有刪除線樣式)。
    3. 尋找「有效流水」為 0 但狀態為 `SETTLED` 的單 (可能是免費旋轉 Free Spin)。
    4. 確認其投注額為 0，輸贏結果等於中獎金額。

### [ ] AC 3：詳情穿透驗證
- **測試步驟**:
    1. 點擊列表右側的「詳情」按鈕。
    2. 確認彈窗顯示原始 JSON 結構。
    3. 驗證 JSON 內的 `vendor`, `game`, `amount_bet` 等欄位與列表顯示一致。

### [ ] AC 4：多維度搜尋驗證
- **測試步驟**:
    1. **玩家搜尋**: 輸入 `P10001`，確認僅顯示該玩家紀錄。
    2. **供應商搜尋**: 選擇 `PG Soft`，確認 `Provider` 欄位皆為 PG。
    3. **局號搜尋**: 複製任一筆局號 (如 `R_xxxxx`) 貼上搜尋，應只顯示該筆資料。

## OPE-205 會員標籤管理 - 驗證指南

請至 `/admin/players`，點擊列表右上角的「標籤管理」按鈕。

### [ ] AC 1：抽屜交互驗證
- **測試步驟**:
    1. 點擊「標籤管理」按鈕。
    2. 確認右側滑出抽屜，且背景頁面變為暗色不可操作。
    3. 點擊抽屜右上角或背景關閉抽屜。

### [ ] AC 2：標籤權限驗證
- **測試步驟**:
    1. 在抽屜中找到「一般玩家」(系統預設)。
    2. 點擊編輯圖示，確認「名稱」欄位為禁用狀態(無法修改)。
    3. 確認操作列的「刪除」按鈕為禁用狀態。
    4. 嘗試編輯「VIP」(自定義)，確認名稱可修改。

### [ ] AC 3：即時同步驗證
- **測試步驟**:
    1. 開啟「標籤管理」抽屜，點擊「新增標籤」。
    2. 輸入名稱 `HighRoller`，備註 `測試同步`，點擊儲存。
    3. 關閉抽屜，點擊「新增玩家 (測試)」或搜尋欄的標籤下拉選單。
    4. 確認下拉選單中出現 `HighRoller`。

### [ ] AC 4：狀態控管驗證
- **測試步驟**:
    1. 開啟抽屜，將 `HighRoller` 的狀態開關關閉 (停用)。
    2. 關閉抽屜。
    3. 再次開啟「新增玩家」的標籤選單。
    4. 確認 `HighRoller` 已從選單中消失。
    5. 開啟抽屜，嘗試刪除 `HighRoller` (需為停用狀態且無人使用)。
    6. 確認刪除成功。

## OPE-206 獎勵卡歷史紀錄 - 驗證指南

請至「帳務管理 > 獎勵卡歷史紀錄」或 `/admin/bonus-history` 查看。

### [ ] AC 1：Card_ID 查詢精確性
- **測試步驟**:
    1. 在「Card ID」搜尋框輸入 `CARD_SUCCESS_001`。
    2. 點擊查詢，確認僅顯示該筆紀錄。
    3. 驗證顯示的初始金額、目標流水與實際轉換金額是否正確 (500, 2500, 500)。

### [ ] AC 2：狀態顯示正確性 (成功情境)
- **測試步驟**:
    1. 搜尋 `CARD_SUCCESS_001`。
    2. 確認狀態顯示為「成功」(綠色標籤)。
    3. 確認「實際轉換」欄位為 500 (綠色粗體)。
    4. 點擊「詳情」按鈕，查看時間軸最後一筆，應註記「Transferred 500 (Cap limit), Burned overflow: 200」。

### [ ] AC 3：狀態顯示正確性 (失敗/過期情境)
- **測試步驟**:
    1. 搜尋 `CARD_EXPIRE_001`，確認狀態為「失敗」，失敗原因為「已過期 (Expired)」。
    2. 搜尋 `CARD_ABANDON_001`，確認狀態為「失敗」，失敗原因為「玩家手動放棄 (Player Abandoned)」。
    3. 點擊詳情，驗證時間軸中有「ABANDONED」事件，並記錄當時的流水進度 (450/1500)。

### [ ] AC 4：破產豁免紀錄驗證
- **測試步驟**:
    1. 搜尋 `CARD_BANKRUPT_001`。
    2. 確認狀態為「失敗」，失敗原因為「餘額不足/破產歸零 (Bankruptcy)」。
    3. 點擊詳情，確認「剩餘餘額」顯示為 0，達成流水為 120/500。
    4. 驗證時間軸最後一筆事件為「BANKRUPTED」，註記「Protection triggered」。

### [ ] AC 5：數據一致性驗證
- **測試步驟**:
    1. 任選一筆紀錄，點擊詳情。
    2. 確認「達成流水 (current_wagering)」與「目標流水 (target_wagering)」數值合理。
    3. 對於成功卡片，驗證：實際轉換 ≤ Cap，且 ≤ 剩餘餘額。

